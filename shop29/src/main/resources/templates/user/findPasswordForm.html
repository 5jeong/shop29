<div th:insert="fragments/header :: header"></div>

<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}" href="../../static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin-top: 50px;
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .form-control, .btn {
            height: 48px;
            font-size: 16px;
        }

        .btn-primary {
            background-color: #333;
            border: none;
            border-radius: 25px;
        }

        .btn-primary:hover {
            background-color: #555;
        }

        .btn-secondary {
            border-radius: 25px;
        }

        label {
            font-weight: bold;
            margin-top: 20px;
        }

        .field-error {
            color: #dc3545;
            font-size: 14px;
        }

        .text-center h2 {
            margin-bottom: 10px;
        }

        .text-muted {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="py-5 text-center">
        <h2>비밀번호 찾기</h2>
        <p class="text-muted"> 가입한 아이디와 이메일을 입력해주세요.</p>
        <p class="text-muted"> 이메일을 통해 임시 비밀번호를 전송해드립니다.</p>
    </div>
    <form>

        <div>
            <label for="email" >아이디</label>
            <div class="input-group">
                <input type="text" id="userId" name="userId"
                       class="form-control" placeholder="가입한 아이디 입력 ">
                <button type="button" class="btn btn-outline-secondary" onclick="checkUserId()">아이디 확인</button>
            </div>
        </div>

        <div>
            <div class="input-group" id="emailform" style="display: none">
                <label for="email">이메일</label>
                <div class="input-group">
                    <input type="text" id= "email" name="email" class="form-control" placeholder="이메일 입력 ex) sample@naver.com">
                    <button type="button" class="btn btn-outline-secondary" onclick="sendTempPassword()">임시 비밀번호 받기
                </div>
            </div>
        </div>



        <div class="text-center mt-4">
            <a href="/login" class="w-100 btn btn-primary btn-lg">로그인하러 가기</a>
        </div>
</div>
<script>
    function checkUserId() {
        const userId = document.getElementById('userId').value;

        // 아이디 중복 체크 API 호출
        fetch('/user/checkUserId?userId=' + encodeURIComponent(userId))
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    document.getElementById('emailform').style.display='block';
                    alert('아이디가 확인되었습니다. 이메일을 통해 임시비밀번호를 발급받으세요.');
                } else {
                    alert('가입된 계정이 없습니다.');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function sendTempPassword() {
        const userId = document.getElementById('userId').value;
        const email = document.getElementById('email').value;

        // 이메일 형식 유효성 검사
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert("올바른 이메일 형식이 아닙니다.");
            return;
        }

        // 폼 데이터 생성
        const formData = new URLSearchParams();
        formData.append('userId', userId);
        formData.append('email', email);

        fetch('/email/sendTempPassword', {
            method: 'POST',  // POST 요청을 사용
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'  // 폼 데이터 형식으로 전송
            },
            body: formData.toString()  // URLSearchParams를 문자열로 변환하여 전송
        })
            .then(response => response.json())
            .then(data => {
                if (data && data.success) {
                    alert('임시 비밀번호가 이메일로 발송되었습니다.');
                } else {
                    alert('이메일 발송에 실패했습니다.');
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>

</body>
</html>
