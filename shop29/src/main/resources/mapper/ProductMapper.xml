<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.toy2.shop29.dao.ProductMapper">


    <!-- product_id를 input으로 받아 해당하는 product를 반환하는 select -->
    <select id="select" parameterType="int" resultType="com.toy2.shop29.product.domain.ProductDto">
        SELECT product_id,
               product_name,
               small_category_id,
               brand_id,
               price,
               sale_ratio,
               is_exclusive,
               created_date,
               created_id,
               updated_date,
               updated_id
        FROM product
        where product_id = #{product_id}
    </select>


    <!-- 전체 product들 모두 읽어오기 -->
    <select id="selectAll" resultType="com.toy2.shop29.product.domain.ProductDto">
        SELECT product_id,
               product_name,
               small_category_id,
               brand_id,
               price,
               sale_ratio,
               is_exclusive,
               created_date,
               created_id,
               updated_date,
               updated_id
        FROM product
        ORDER BY product_id ASC;
    </select>


    <!-- 새 product 등록 -->
    <insert id="insert" parameterType="com.toy2.shop29.product.domain.ProductDto">
        INSERT INTO product
        (product_id, product_name, small_category_id, brand_id, price, sale_ratio, is_exclusive, created_date, created_id, updated_date, updated_id)
        VALUES
            (#{product_id}, #{product_name}, #{small_category_id}, #{brand_id}, #{price}, #{sale_ratio}, #{is_exclusive}, #{created_date}, #{created_id}, #{updated_date}, #{updated_id})
    </insert>


    <!-- product 수정 -->
    <!-- 이때 created_id, created_date는 안 바꿔주게 조심 -->
    <update id="update" parameterType="com.toy2.shop29.product.domain.ProductDto">
        UPDATE product
        SET   product_id = #{product_id},
              product_name = #{product_name},
              small_category_id = #{small_category_id},
              brand_id = #{brand_id},
              price = #{price},
              sale_ratio = #{sale_ratio},
              is_exclusive = #{is_exclusive},
              updated_date = now(),
              updated_id = #{updated_id}
        WHERE product_id = #{product_id}
    </update>


    <!-- product 총 갯수 세기 -->
    <select id="count" resultType="int">
        SELECT count(*) FROM product
    </select>


    <!-- product_id를 input 받아 해당하는 product를 삭제 -->
    <delete id="delete" parameterType="int">
        DELETE FROM product WHERE product_id = #{product_id}
    </delete>


    <!-- (쇼핑몰에서 특정 브랜드가 나갈때) 해당 브랜드의 상품을 모두 삭제 -->
    <delete id="deleteByBrand" parameterType="String">
        DELETE FROM product WHERE brand_id = #{brand_id}
    </delete>


    <!-- 올라온 product를 모두 삭제 -->
    <delete id="deleteAll">
        DELETE FROM product
    </delete>

    <!-- deleteByBrand 테스트를 위해 필요한 brand_id 같은 것들 세기 -->
    <select id="brandCount" parameterType="String" resultType="int">
        SELECT count(*) FROM product WHERE brand_id = #{brand_id}
    </select>


</mapper>